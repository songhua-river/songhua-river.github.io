---
layout: post
title: 文件自动同步服务器
abbrlink: 4bf6e0f1
date: 2020-12-26 21:20:25
categories:
  - JavaScript
  - 工程化
tags:
  - 工程化
---

#### index.js 

```javascript
#!/usr/bin/env node

const shell = require('shelljs')
const chokidar = require('chokidar')
const home = require('user-home')
const path = require('path')

const WORKSPACE_PATH = path.resolve(home, 'Workspace');

const expectPath = path.join(__dirname, './expect.exp')
const to = 'root@144.xxx.xxx.92:/home/backup'

chokidar
  .watch('./index.js', {
    ignored: (path) => path.includes('node_modules') || path.includes('.git')
  })
  .on('all', (event, path) => {
    console.log(event, path);
    shell.exec(`expect ${expectPath} ${path} ${to}`)
  }); 

```

#### expect.exp

```bash
#expect 不能写错
#!/usr/bin/expect

set from [lindex $argv 0]
set to [lindex $argv 1]

set timeout 30

spawn bash -c "scp $from $to"

# 特殊符号需要转移 回车符号不需要
# \ 需转义为 \\\
# } 需转义为 \}
# [ 需转义为 \[
# $ 需转义为 \\\$
# ` 需转义为 \`
# " 需转义为 \\\"
# ( 需转义为 \(


expect {
  "*password:" { send -- "j\(S7?xx#ky6\[0n=R\r" }
}

# 必须要加这一句，在执行完毕后把持交互状态，把控制台，这时候就可以进行你想要进行的操作了。如果没有这一句，在登陆完成之后就会退出，而不是留在远程终端上。
interact
```