---
layout: post
title: 生产环境处理
abbrlink: 13dec1bc
categories:
  - webpack
tags:
  - 工程化
  - webpack
date: 2020-01-17 20:46:37
---

#### 提取css文件 

webpack4中可以使用 **[mini-css-extract-plugin](https://webpack.docschina.org/plugins/mini-css-extract-plugin/)**

#### css兼容新处理

**[postcss-loader](https://www.npmjs.com/package/postcss-loader)** 需要安装 `postcss-preset-env`

配置`postcss.config.js`

```javascript
module.exports = {
  plugins: [
    require('postcss-preset-env'),
  ]
}
```
添加浏览器版本配置文件 `.browserslistrc`

```bash
[production]
> 1%
ie 10
[modern]
last 1 chrome version
```

在`webpack.config.js`中使用loader

post默认使用的是 `.browserslistrc` 生产环境的配置，开发环境需要手动修改 `process.env.NODE_ENV='devlopment'` 和 `webpack.config.js`中的`mode`没有关系

#### 压缩css

**[css-minimizer-webpack-plugin](https://www.npmjs.com/package/css-minimizer-webpack-plugin)**直接使用无需配置

#### 编译时检查语法规则

**[eslint-webpack-plugin](https://www.npmjs.com/package/eslint-webpack-plugin)**

一定要在`webpack.config.js`中配置 `exclude: /node_modules/`,只检查自己的代码

**[eslint-plugin-react-hooks](https://www.npmjs.com/package/eslint-plugin-react-hooks)** 在`react-hooks`中使用


#### js兼容处理

配置`babel-loader` 需要安装`@babel/core` 添加 `.babelrc` 文件

使用 `preset-env` [同样存在问题](/posts/731d431a/#babel-polyfill-babel-plugin-transform-runtime-babel-runtime-corejs2)

```json
{
  "presets": [
    [
      "@babel/preset-env",
      {
        // 把用到的polyfill按需引入，依赖core-js
        "useBuiltIns": "useage",
        "corejs":3
      }
    ],
    "@babel/preset-typescript",
    "@babel/preset-react",
    "@babel/plugin-transform-runtime"
  ]
}
```

#### 压缩html

添加[html-webpack-plugin](https://www.npmjs.com/package/html-webpack-plugin)配置项

```javascript
new HtmlWebpackPlugin({
  template: path.resolve(__dirname, 'src/index.html'),
  minify:{
    collapseWhitespace: true,// 移除空白
    removeComments: true,// 移除注释
  }
})
```

